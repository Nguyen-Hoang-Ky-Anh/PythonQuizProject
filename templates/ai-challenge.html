{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>AI Challenge</title>
    <style>
        body { font-family: Arial; margin: 40px; }
        .box {
            padding: 20px;
            border: 2px solid #000;
            width: 500px;
        }
        .correct { color: green; font-weight: bold; }
        .wrong { color: red; font-weight: bold; }
    </style>
</head>
<body>

<h1>AI Challenge: User đấu AI</h1>

<div class="box">
    <p id="question">Nhấn Start để bắt đầu</p>
    <div id="options"></div>

    <button onclick="startQuiz()">Start</button>

    <p><b>Điểm User:</b> <span id="userScore">0</span></p>
    <p><b>Điểm AI:</b> <span id="aiScore">0</span></p>

    <p id="result"></p>
</div>

<script>
let currentQuestion = "";
let userScore = 0;
let aiScore = 0;

function startQuiz() {
    fetch("/ai/api/get_ai_question/")
        .then(res => res.json())
        .then(data => {
            currentQuestion = data.question;
            document.getElementById("question").innerText = data.question;

            let html = "";
            data.options.forEach(opt => {
                html += `<button onclick="submitUserAnswer('${opt}')">${opt}</button><br>`;
            });

            document.getElementById("options").innerHTML = html;
            document.getElementById("result").innerText = "";
        });
}

function submitUserAnswer(userChoice) {
    // user kiểm tra
    fetch("/ai/api/ai_answer/?question=" + encodeURIComponent(currentQuestion))
        .then(res => res.json())
        .then(aiData => {

            let correct = aiData.ai_correct_answer;

            // ---------------------------------
            // USER CHECK
            // ---------------------------------
            if (userChoice === correct) {
                userScore++;
                document.getElementById("result").innerHTML +=
                    `<p class='correct'>User đúng!</p>`;
            } else {
                document.getElementById("result").innerHTML +=
                    `<p class='wrong'>User sai! Đáp án: ${correct}</p>`;
            }

            // ---------------------------------
            // AI CHECK
            // ---------------------------------
            if (aiData.is_correct) {
                aiScore++;
                document.getElementById("result").innerHTML +=
                    `<p class='correct'>AI đúng (${aiData.ai_answer})</p>`;
            } else {
                document.getElementById("result").innerHTML +=
                    `<p class='wrong'>AI sai (${aiData.ai_answer})</p>`;
            }

            document.getElementById("userScore").innerText = userScore;
            document.getElementById("aiScore").innerText = aiScore;
        });
}
</script>

</body>
</html>
